#######################################
# SoylentNews Rehash Initial Release #
#######################################

# Apply these after reinstall rehash but before starting up slashd/apache

UPDATE vars SET value = 'rehash_15_05' WHERE name = 'cvs_tag_currentcode';

# Allow skins to be themeable (our termology here could be better)
ALTER TABLE skins ADD COLUMN theme varchar(255) default '';

# Need to drop 'NOT NULL' due to table change
ALTER TABLE submissions MODIFY comment VARCHAR(255) null;
ALTER TABLE submissions MODIFY mediatype enum('text','none','video','image','audio') null DEFAULT 'none';
ALTER TABLE submissions MODIFY name varchar (50) null;
ALTER TABLE stories ADD COLUMN notes text;

# New Rehash topic
INSERT INTO topics (tid, keyword, textname, series, image, width, height, submittable) VALUES (25,'rehash', 'Rehash', 'no', 'topicrehash.png',112,36,'yes');

# Fix Poll Insert
ALTER TABLE pollquestions CHANGE discussion discussion mediumint UNSIGNED NULL;

# Modify Search Order Opations
DELETE FROM code_param WHERE type = 'sortorder';
INSERT INTO code_param (type, code, name) VALUES ('sortorder', '1', 'Sort By Relevancy');
INSERT INTO code_param (type, code, name) VALUES ('sortorder', '2', 'Sort By Date (Most Recent First)');
INSERT INTO code_param (type, code, name) VALUES ('sortorder', '3', 'Sort By Date (Oldest First)');

# Fix <p> tags in subs
INSERT INTO vars (name, value, discription) VALUES ('submit_keep_p',1,'Keep <p> tags in story submissions');
